<html>
<head>
    <meta charset="utf-8">
    <style>
        .background {
            fill: none;
            pointer-events: all;
        }

        #states {
            fill: #aaa;
        }

            #states .active {
                fill: orange;
            }

        #state-borders {
            fill: none;
            stroke: #fff;
            stroke-width: 1.5px;
            stroke-linejoin: round;
            stroke-linecap: round;
            pointer-events: none;
        }
        #callout
        {
            position:absolute;
            left:400px;
            top:400px;
            width:100px;
            height:100px;
        }
    </style>
</head>
<body>
    
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script>

        var ageOut = [NaN, 8.51, 1.98, 1, 6.42, 6.78, 8.04, NaN, 8.89,2.64, 11.24, NaN, 6.41,7.02,NaN, 8.29, 6.79, 5.11, 3.45, 6.62, 7.59, 9.88, 4.36,6.33,12.80,10.81, 5.82,11.17,2.06, 4.6, 4.07, 5.88, 4.76, 6.74, 5.17, 5.22, 5.40,5.99, 5.82, 11.41, 3.91, 2.75, 6.02,NaN, 7.14, 9.58,5.54,6.64,4.26,7,98,13.99,NaN,4.27,1.18, 6.84, 2.71 ]// 8.89,2.64,11.24,6.41,7.02,8.29,6.79,5.11,3.45,6.62,7.59,9.88,4.36,6.33,12.80,10.81,5.82,11.17,2.06,4.6,4.07,5.88,4.76,6.74,5.17,5.22,5.4,5.99,5.82,11.41,3.91,2.75,6.02,7.14,9.58,5.54,6.64,4.26,7.96,5.94,13.99,4.27,9.07,1.18,6.84,2.71];
        var width = 960,
            height = 500,
            centered;

        var projection = d3.geo.albersUsa()
            .scale(1070)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        var colorScale = d3.scale.linear().domain([1.18,5.63,  14]).range(['green','orange','red']);

        
        svg.append("rect")
            .attr("class", "background")
            .attr("width", width)
            .attr("height", height)
            .on("click", clicked);

        var g = svg.append("g");

        d3.json("us.js", function (error, us) {
            g.append("g")
                .attr("id", "states")
              .selectAll("path")
                .data(topojson.feature(us, us.objects.states).features)
              .enter().append("path")
                .attr("d", path)
                .style("fill", function (elem) {
                    if (ageOut[elem.id]) {
                        if (ageOut[elem.id] == 1) { return "yellow"; }
                        return colorScale(ageOut[elem.id]);
                    }
                    return "blue";

                })
                .on("mousemove", onMouseMove)
                .on("click", clicked);
                
                

            g.append("path")
                .datum(topojson.mesh(us, us.objects.states, function (a, b) { return a !== b; }))
                .attr("id", "state-borders")
                .attr("d", path);
        });
        function onMouseMove(d) {
            $("#result").text(d.id);
            var event = d3.event;
            $("#callout").css("left", event.pageX);
            $("#callout").css("top", event.pageY);

        }
        function clicked(d) {
            var x, y, k;

            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }

            g.selectAll("path")
                .classed("active", centered && function (d) { return d === centered; });

            g.transition()
                .duration(750)
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                .style("stroke-width", 1.5 / k + "px");
        }
    </script>
    <div id="callout">
        callout
    </div>
    <div id="result"></div>
</body>
</html>